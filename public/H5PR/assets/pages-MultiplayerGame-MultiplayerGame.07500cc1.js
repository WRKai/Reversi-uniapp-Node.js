import{o as a,c as e,w as t,b as l,a as s,f as u,k as r,t as o,i as n,h as i,x as m,y as c,D as d,C as p,E as f,G as v,s as _,j as b,e as h,n as g,F as w,H as y,r as k,B as x,z as S,A as P}from"./index-cf322eb6.js";import{_ as T,u as O,o as M,a as I,c as A,d as C,r as $,b as N}from"./room.3c1d58fc.js";const j=T({name:"uniPopupMessage",mixins:[{data:()=>({}),created(){this.popup=this.getParent()},methods:{getParent(a="uniPopup"){let e=this.$parent,t=e.$options.name;for(;t!==a;){if(e=e.$parent,!e)return!1;t=e.$options.name}return e}}}],props:{type:{type:String,default:"success"},message:{type:String,default:""},duration:{type:Number,default:3e3},maskShow:{type:Boolean,default:!1}},data:()=>({}),created(){this.popup.maskShow=this.maskShow,this.popup.messageChild=this},methods:{timerClose(){0!==this.duration&&(clearTimeout(this.timer),this.timer=setTimeout((()=>{this.popup.close()}),this.duration))}}},[["render",function(m,c,d,p,f,v){const _=n,b=i;return a(),e(b,{class:"uni-popup-message"},{default:t((()=>[l(b,{class:s(["uni-popup-message__box fixforpc-width","uni-popup__"+d.type])},{default:t((()=>[u(m.$slots,"default",{},(()=>[l(_,{class:s(["uni-popup-message-text","uni-popup__"+d.type+"-text"])},{default:t((()=>[r(o(d.message),1)])),_:1},8,["class"])]),!0)])),_:3},8,["class"])])),_:3})}],["__scopeId","data-v-d81cfb56"]]),K=T(m({__name:"MultiplayerGame",setup(e){const s=O(),u=c(),n=c(!1),m=d((()=>n.value?2:1)),T=d((()=>n.value?1:2)),K=c(!0);var Y=!1,B=null,G=null,H=null,z=null,D=!1;M((()=>{z=setTimeout((async()=>{await I({url:"/api/post-spStatus",method:"POST",data:{room_number:s.room_number}}),await I({url:"/api/post-end-game",method:"POST",data:{room_number:s.room_number}}),la(),p({url:"/pages/index/index"})}),6e4)})),A((()=>{z&&(clearTimeout(z),z=null,L("离开游戏超过1分钟, 将强制退出对局!","warn"))})),C((async()=>{const a=s.initNumber;if(a)await I({url:"/api/post-init",method:"POST",data:{initNumber:a,room_number:s.room_number}}),a%2==0?(L("你是先手","success"),n.value=!0):L("你是后手","success");else{f({title:"加载中...",mask:!0});let a=null;await new Promise((e=>{let t=setInterval((async()=>{a=await I({url:"/api/get-init-new",method:"POST",data:{room_number:s.room_number}}),a.data.initNumber&&(clearInterval(t),v(),e("OK"))}),1080)})),a.data.initNumber%2==1?(L("你是先手","success"),n.value=!0):L("你是后手","success")}for(E.value[4][4]=1,E.value[4][5]=2,E.value[5][4]=2,E.value[5][5]=1,B=setInterval((async()=>{const a=await I({url:"/api/get-spStatus",method:"POST",data:{room_number:s.room_number}});console.log(a),a.data.spStatus&&(L("对手似乎离开了游戏, 3秒后自动退出......","warn"),_({duration:3e3,mask:!0,title:"3秒后自动退出对局......",icon:"error"}),la(),await I({url:"/api/post-end-game",method:"POST",data:{room_number:s.room_number}}),setTimeout((()=>{p({url:"/pages/index/index"})}),2999))}),25e3);;){if(n.value===K.value){if(!R(m.value)){if(L("您轮空了! 又到对手了......","warn"),await I({url:"/api/post-latest-gaming",method:"POST",data:{room_number:s.room_number,latestMsg:{row:-1,col:-1,turn:m.value}}}),D)break;D=!0,K.value=!K.value;continue}D=!1,W.value="现在由您执棋",Y=!0,await new Promise((a=>{G=setInterval((()=>{Y||(clearInterval(G),G=null,a("OK"))}),1080)})),K.value=!K.value,W.value="等待对方......"}else{F.value=new Array(10).fill(0).map((()=>new Array(10).fill(0))),R(T.value),W.value="等待对方中......";let a=null;await new Promise((e=>{H=setInterval((async()=>{a=await I({url:"/api/get-latest-gaming",method:"POST",data:{room_number:s.room_number}}),a.data.latestMsg&&a.data.latestMsg.turn===T.value&&(clearInterval(H),H=null,e("OK"))}),1080)}));let e=a.data.latestMsg.row,t=a.data.latestMsg.col;if(-1===e&&-1===t){L("对手轮空! 现在是我的回合!","success"),D=!0,K.value=!K.value;continue}D=!1,E.value[e][t]=T.value,X(e,t,T.value),W.value="对方已置棋!",K.value=!K.value}ea()}L("游戏结束!统计中..."),await I({url:"/api/post-end-game",method:"POST",data:{room_number:s.room_number}}),ea();let e="还能平局?";Z.value>aa.value?e="白棋获胜!":Z.value<aa.value&&(e="黑棋获胜!"),b({title:e,content:`白:${Z.value}, 黑:${aa.value}`,showCancel:!1,confirmText:"回到主页",success:a=>{a.confirm&&(la(),p({url:"/pages/index/index"}))}})}));const E=c(new Array(10).fill(0).map((()=>new Array(10).fill(0)))),F=c(new Array(10).fill(0).map((()=>new Array(10).fill(0)))),q=c("info"),J=c("NIHAOMA煞笔真没二"),L=(a="你女子",e="info")=>{J.value=a,q.value=e,u.value.open()},Q=new Array(10).fill(0).map((()=>new Array(10).fill(0).map((()=>new Array(8).fill(0))))),R=a=>{let e=!1;for(let t=1;t<=8;t++)for(let l=1;l<=8;l++)F.value[t][l]=V(t,l,a),F.value[t][l]&&(e=!0);return e},U=[[0,1],[1,0],[1,1],[-1,-1],[-1,0],[0,-1],[1,-1],[-1,1]],V=(a,e,t)=>{if(E.value[a][e])return!1;let l=!1;for(let s=0;s<8;s++){Q[a][e][s]=0;let u=a+U[s][0],r=e+U[s][1];if(u<1||r<1||u>8||r>8)continue;let o=E.value[u][r];if(o&&o-1!=t-1){let u=a,r=e,o=!1;for(;u+=U[s][0],r+=U[s][1],!(u<1||r<1||u>8||r>8);){let a=E.value[u][r];if(!a)break;if(a===t){l=!0,o=!0;break}}o&&(Q[a][e][s]=1)}}return!!l},W=c(""),X=(a,e,t)=>{for(let l=0;l<8;l++){let s=a,u=e;if(Q[a][e][l])for(;s+=U[l][0],u+=U[l][1],!(s<1||u<1||s>8||u>8);){let a=E.value[s][u];if(!a||a===t)break;E.value[s][u]=1+(E.value[s][u]-1^1)}}},Z=c(2),aa=c(2),ea=()=>{let a=0,e=0;for(let t=1;t<=8;t++)for(let l=1;l<=8;l++)1===E.value[t][l]?a++:2===E.value[t][l]&&e++;Z.value=a,aa.value=e},ta=()=>{b({title:"提示",content:"确定退出对局?",confirmColor:"#C00000",success:async a=>{a.confirm&&(await I({url:"/api/post-spStatus",method:"POST",data:{room_number:s.room_number}}),await I({url:"/api/post-end-game",method:"POST",data:{room_number:s.room_number}}),la(),p({url:"/pages/index/index"}))}})},la=()=>{G&&clearInterval(G),H&&clearInterval(H),B&&clearInterval(B),z&&clearTimeout(z)};return(e,c)=>{const d=$(k("uni-popup-message"),j),p=$(k("uni-popup"),N),f=i,v=x;return a(),h(w,null,[l(p,{ref_key:"topPopupTips",ref:u,type:"message"},{default:t((()=>[l(d,{type:q.value,message:J.value,duration:2e3},null,8,["type","message"])])),_:1},512),l(f,{class:"tips-info-box"},{default:t((()=>[r(" 对局中...... "),l(f,{class:"display-your-chess"},{default:t((()=>[l(f,null,{default:t((()=>[r(" 您执: ")])),_:1}),l(f,{class:"chess-block"},{default:t((()=>[l(f,{class:"chess",style:g({transform:`rotateY(${n.value?180:0}deg)`})},{default:t((()=>[l(f,{class:"front"}),l(f,{class:"back"})])),_:1},8,["style"])])),_:1})])),_:1}),l(f,{class:"display-turn"},{default:t((()=>[l(v,{class:"btn",disabled:n.value!==K.value},{default:t((()=>[r(o(W.value),1)])),_:1},8,["disabled"])])),_:1}),l(f,{class:"exit-btn"},{default:t((()=>[l(v,{class:"btn",onClick:ta},{default:t((()=>[r("×")])),_:1})])),_:1}),l(f,{class:"remain-chess-cnt"},{default:t((()=>[l(f,{class:"black-remain"},{default:t((()=>[l(f,{class:"chess-block"},{default:t((()=>[l(f,{class:"chess",style:{transform:"rotateY(180deg)"}},{default:t((()=>[l(f,{class:"front"}),l(f,{class:"back"})])),_:1})])),_:1}),l(f,null,{default:t((()=>[r("x"+o(aa.value),1)])),_:1})])),_:1}),l(f,{class:"white-remain"},{default:t((()=>[l(f,{class:"chess-block"},{default:t((()=>[l(f,{class:"chess"},{default:t((()=>[l(f,{class:"front"}),l(f,{class:"back"})])),_:1})])),_:1}),l(f,null,{default:t((()=>[r("x"+o(Z.value),1)])),_:1})])),_:1})])),_:1})])),_:1}),l(f,{style:{height:"800rpx","margin-bottom":"250rpx"}}),l(f,{class:"container"},{default:t((()=>[(a(),h(w,null,y(64,((a,e)=>l(f,{class:"chess-block","data-row":Math.floor(e/8)+1,"data-col":e%8+1,onClick:a=>(async(a,e)=>Y?F.value[a][e]?(E.value[a][e]=m.value,X(a,e,m.value),Y=!1,void(await I({url:"/api/post-latest-gaming",method:"POST",data:{room_number:s.room_number,latestMsg:{row:a,col:e,turn:m.value}}}))):L("仅能在指定位置置棋(以黄点标记)","error"):L("当前不是你的回合","error"))(Math.floor(e/8)+1,e%8+1),"data-color":0},{default:t((()=>[S(l(f,{class:"able-to-chess"},null,512),[[P,F.value[Math.floor(e/8)+1][e%8+1]&&n.value===K.value]]),S(l(f,{class:"chess",style:g({transform:`rotateY(${2==E.value[Math.floor(e/8)+1][e%8+1]?180:0}deg)`})},{default:t((()=>[l(f,{class:"front"}),l(f,{class:"back"})])),_:2},1032,["style"]),[[P,E.value[Math.floor(e/8)+1][e%8+1]]])])),_:2},1032,["data-row","data-col","onClick"]))),64))])),_:1})],64)}}}),[["__scopeId","data-v-e1674ad6"]]);export{K as default};
